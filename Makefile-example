# Tell Makefile to use bash
SHELL := /bin/bash

.PHONY: first-setup reload setup-web build start stop restart composer-install migrate seed clean exec

first-setup:
	git submodule init
	git submodule update
	cp -i .env.example .env
	cp -i php/xdebug.ini.example php/xdebug.ini
	make reload

reload:
	cp -i deploy/docker/.env.dev docker/.env
	cp -i deploy/docker/docker-compose.yml docker/docker-compose.yml
	bash docker/scripts/setup-schedule.sh
	bash docker/scripts/setup-worker.sh
	make setup-web

setup-web:
	bash docker/scripts/setup-web.sh

build:
	cd docker; docker-compose build;

start:
	cd docker; docker-compose up -d;
	make composer-install
	make migrate

stop:
	cd docker; docker-compose stop;

restart:
	make stop
	make start

composer-install:
	cd docker; docker-compose exec web composer install --ignore-platform-reqs

migrate:
	cd docker; docker-compose exec web php artisan migrate

seed:
	cd docker; docker-compose exec web php artisan db:seed

clean:
	cd docker; docker-compose exec web php artisan cache:clear

exec:
	docker-compose exec web $(filter-out $@,$(MAKECMDGOALS))

%:
	@: